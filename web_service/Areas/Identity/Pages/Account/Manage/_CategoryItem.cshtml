@model web_service.Models.Admin.CategoryItemViewModel
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@using web_service.Models.Admin
@{
    var collapseId = $"children-{Model.Category.Id}";
    var hasChildren = Model.Category.Children.Any();
    var indent = Model.Level * 1.5;
}

<li class="list-group-item">
    <div class="d-flex align-items-center">
        @if (hasChildren)
        {
            <button class="btn btn-sm btn-link me-2 p-0"
                    data-bs-toggle="collapse"
                    data-bs-target="#@collapseId"
                    aria-expanded="false"
                    aria-controls="@collapseId">
                <i class="fas fa-chevron-right"></i>
            </button>
        }
        else
        {
            <span class="me-2" style="width:1.25rem;"></span>
        }

        <span style="margin-left:@($"{indent}rem")">
            @Model.Category.CategoryName
        </span>

        <div class="ms-auto d-flex align-items-center">
            <button class="btn btn-sm btn-outline-secondary me-1"
                    data-bs-toggle="modal"
                    data-bs-target="#editModal"
                    onclick="prepareModal('', '@Model.Category.Id')"
                    title="Добавить подкатегорию">
                <i class="fas fa-plus"></i>
            </button>

            <button class="btn btn-sm btn-outline-primary me-1"
                    data-bs-toggle="modal"
                    data-bs-target="#editModal"
                    onclick="prepareModal('@Model.Category.Id', '@Model.Category.ParentId')"
                    title="Редактировать">
                <i class="fas fa-edit"></i>
            </button>

            <form method="post"
                  asp-page-handler="Delete"
                  asp-route-id="@Model.Category.Id"
                  onsubmit="return confirm('Удалить категорию?');"
                  class="d-inline">
                <button type="submit"
                        class="btn btn-sm btn-outline-danger"
                        title="Удалить">
                    <i class="fas fa-times"></i>
                </button>
            </form>
        </div>
    </div>

    @if (hasChildren)
    {
        <ul class="list-group list-group-flush collapse mt-1" id="@collapseId">
            @foreach (var child in Model.Category.Children)
            {
                @Html.Partial("_CategoryItem", new CategoryItemViewModel { Category = child, Level = Model.Level + 1 })
            }
        </ul>
    }
</li>